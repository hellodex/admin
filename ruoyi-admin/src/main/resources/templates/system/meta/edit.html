<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改代币基本信息')" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-meta-edit" th:object="${tokenMeta}">
            <input name="id" th:field="*{id}" type="hidden">
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">全名：</label>
                    <div class="col-sm-8">
                        <input name="name" th:field="*{name}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">简称：</label>
                    <div class="col-sm-8">
                        <input name="symbol" th:field="*{symbol}" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">合约地址：</label>
                    <div class="col-sm-8">
                        <input name="address" th:field="*{address}" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">链标识：</label>
                    <div class="col-sm-8">
                        <input name="chainCode" th:field="*{chainCode}" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">精度：</label>
                    <div class="col-sm-8">
                        <input name="decimals" th:field="*{decimals}" class="form-control" type="text" required>
                    </div>
                </div>
            </div>

            <!-- 或者使用文件上传 -->
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">图片：</label>
                    <div class="col-sm-8">
                        <input name="file" class="form-control-file" type="file" accept="image/*">
                        <small class="form-text text-muted">请选择要上传的图片文件。</small>
                        <img id="preview" src="#" alt="图片预览" style="display:none; max-width: 100%; margin-top: 10px;">
                        <small id="error-message" class="form-text text-danger" style="display:none;">文件上传失败，请重试。</small>
                        <input style="width: 450px" name="logo" th:field="*{logo}" class="form-control" disabled type="text">
                    </div>
                </div>
            </div>

            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">几个火：</label>
                    <div class="col-sm-8">
                        <input name="hot" th:field="*{hot}" class="form-control" type="number" min="0" max="10"  placeholder="请输入火个数 (0-10)">
                    </div>
                </div>
            </div>

            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">协议名：</label>
                    <div class="col-sm-8">
                        <input
                                name="protocolUrl"
                                th:field="*{protocol}"
                                class="form-control"
                                type="text"
                                placeholder="请输入协议地址，例如 http://example.com"
                                pattern="https?://.+"
                                title="请输入有效的协议地址，必须以http://或https://开头"
                        >
                        <small id="protocolUrlHelp" class="form-text text-muted">请确保输入有效的协议地址。</small>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">协议地址：</label>
                    <div class="col-sm-8">
                        <input name="protocolUrl" th:field="*{protocolUrl}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">白皮书地址：</label>
                    <div class="col-sm-8">
                        <input name="whitePaper" th:field="*{whitePaper}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">网站：</label>
                    <div class="col-sm-8">
                        <input name="website" th:field="*{website}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">discord：</label>
                    <div class="col-sm-8">
                        <input name="discord" th:field="*{discord}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">twitter：</label>
                    <div class="col-sm-8">
                        <input name="twitter" th:field="*{twitter}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">telegram：</label>
                    <div class="col-sm-8">
                        <input name="telegram" th:field="*{telegram}" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">备注：</label>
                    <div class="col-sm-8">
                        <textarea name="comment" class="form-control">[[*{comment}]]</textarea>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <script th:inline="javascript">
        var prefix = ctx + "system/meta";
        $("#form-meta-edit").validate({
            focusCleanup: true
        });

        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/edit", $('#form-meta-edit').serialize());
            }
        }


        //图片的功能
        document.querySelector('input[name="file"]').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview').src = e.target.result;
                    document.getElementById('preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('preview').style.display = 'none';
            }
        });


        //---------------------时间判断-------------------------------------
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');

        // 确保结束时间不能早于开始时间
        function updateMinMax() {
            const startTime = startTimeInput.value;
            const endTime = endTimeInput.value;

            if (isValidTime(startTime)) {
                endTimeInput.setAttribute('min', startTime);
            } else {
                endTimeInput.removeAttribute('min');
            }

            if (isValidTime(endTime)) {
                startTimeInput.setAttribute('max', endTime);
            } else {
                startTimeInput.removeAttribute('max');
            }
        }

        function isValidTime(timeString) {
            const time = new Date(timeString);
            return !isNaN(time.getTime());
        }

        startTimeInput.addEventListener('change', function () {
            updateMinMax();
            // 触发失去焦点以关闭时间选择器
            startTimeInput.blur();
        });

        endTimeInput.addEventListener('change', function () {
            updateMinMax();
            // 触发失去焦点以关闭时间选择器
            endTimeInput.blur();
        });

        // 表单提交前的验证
        document.querySelector('form').addEventListener('submit', function (event) {
            const startTime = startTimeInput.value;
            const endTime = endTimeInput.value;

            if (!startTime || !endTime) {
                alert('请填写完整的时间信息');
                event.preventDefault();
                return;
            }

            if (new Date(endTime) < new Date(startTime)) {
                alert('结束时间不能早于开始时间');
                event.preventDefault();
            }
        });

        //---------------------时间判断-------------------------------------

    </script>
</body>
</html>